# Maintainer: Chad
# Based on official nnn package with restorepreview patch

pkgname=nnn-restorepreview
pkgver=5.1
pkgrel=1
pkgdesc="The unorthodox terminal file manager (with restorepreview patch)"
arch=('x86_64')
url="https://github.com/jarun/nnn"
license=('BSD-2-Clause')
depends=('readline')
optdepends=(
    'atool: for more archive formats'
    'libarchive: for more archive formats'
    'zip: for ZIP archives'
    'unzip: for ZIP archives'
    'trash-cli: to trash files'
    'sshfs: mount remote filesystems'
    'rclone: mount cloud storage'
    'fuse2: unmount remotes'
    'xdg-utils: desktop opener'
    'bat: syntax highlighting in preview'
    'mediainfo: media file info in preview'
    'ffmpegthumbnailer: video thumbnails in preview'
    'glow: markdown preview'
    'w3m: HTML preview'
)
provides=('nnn')
conflicts=('nnn')
source=("$pkgname-$pkgver.tar.gz::https://github.com/jarun/nnn/archive/v$pkgver.tar.gz")

build() {
    cd "nnn-$pkgver"

    # Build with restorepreview patch
    make O_RESTOREPREVIEW=1
}

package() {
    cd "nnn-$pkgver"

    # Install binary
    install -Dm755 nnn "$pkgdir/usr/bin/nnn"

    # Install man page
    install -Dm644 nnn.1 "$pkgdir/usr/share/man/man1/nnn.1"

    # Install desktop file
    install -Dm644 misc/desktop/nnn.desktop "$pkgdir/usr/share/applications/nnn.desktop"

    # Install icons
    install -Dm644 misc/logo/logo-64x64.png "$pkgdir/usr/share/icons/hicolor/64x64/apps/nnn.png"
    install -Dm644 misc/logo/logo.svg "$pkgdir/usr/share/icons/hicolor/scalable/apps/nnn.svg"

    # Install plugins
    install -dm755 "$pkgdir/usr/share/nnn/plugins"
    install -m755 plugins/* "$pkgdir/usr/share/nnn/plugins"

    # Install quitcd helpers
    install -dm755 "$pkgdir/usr/share/nnn/quitcd"
    install -m644 misc/quitcd/* "$pkgdir/usr/share/nnn/quitcd"

    # Install auto-completion
    install -Dm644 misc/auto-completion/bash/nnn-completion.bash \
        "$pkgdir/usr/share/bash-completion/completions/nnn"
    install -Dm644 misc/auto-completion/fish/nnn.fish \
        "$pkgdir/usr/share/fish/vendor_completions.d/nnn.fish"
    install -Dm644 misc/auto-completion/zsh/_nnn \
        "$pkgdir/usr/share/zsh/site-functions/_nnn"

    # Install license
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
